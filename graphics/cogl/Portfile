# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:filetype=tcl:et:sw=4:ts=4:sts=4
# $Id: Portfile 77796 2011-04-13 18:11:43Z devans@macports.org $

PortSystem          1.0

name                cogl
version             1.14.0
set branch          [string range $version 0 [expr [string last "." $version] - 1]]
categories          graphics
maintainers         devans openmaintainer
platforms           darwin macosx
description         Clutter OpenGL support library
long_description    Clutter is an open source software library for \
                    creating fast, visually rich and animated graphical \
                    user interfaces.
homepage            http://www.clutter-project.org/
master_sites        http://download.gnome.org/sources/${name}/${branch}/
use_xz              yes


checksums           md5     7eabaf4241c0b87cc9e3b0fa23fd0315 \
                    sha1    ff9a60b54fe79eb336af9c1b686f71f6af6f84f9 \
                    rmd160  69a87d46c21999bde675a518ab3cbb5dfa159131

depends_build       port:pkgconfig

depends_lib         port:cairo \
                    port:pango \
                    port:gobject-introspection


patchfiles          0001-New-error-parameter-added-to-bitmap-functions.patch


configure.args      --enable-introspection=no \
                    --enable-debug=no
configure.ldflags-append    -framework ApplicationServices

post-patch {
    reinplace "/SUBDIRS/s/tests//" ${worksrcpath}/Makefile.am
}

use_autoreconf  yes
autoreconf.args -fvi

#
# if clutter is installed and version is less than 1.12.0
# deactivate clutter before activating cogl to avoid conflict
#
# previous versions included cogl in port clutter
#

pre-activate {
    if { [file exists ${prefix}/lib/pkgconfig/clutter-1.0.pc]
        && ![catch {set vers [lindex [registry_active clutter] 0]}]
        && [vercmp [lindex $vers 1] 1.12.0] < 0} {

        registry_deactivate clutter "" "" "" [list ports_nodepcheck 1]
     }
}

variant x11 conflicts quartz {
    depends_lib-append      port:gdk2-pixbuf \
                            port:xorg-libXcomposite \
                            port:xorg-libXdamage \
                            port:xorg-libXext \
                            port:mesa

    configure.args-append   --enable-gdk-pixbuf=yes \
                            --enable-quartz-image=no \
                            --with-x
}

variant quartz conflicts x11 {
    configure.args-append   --enable-gdk-pixbuf=no \
                            --enable-quartz-image=yes \
                            --without-x \
                            --enable-glx=no
}

variant debug {
    configure.args-delete   --enable-debug=no
    configure.args-append   --enable-debug=yes
}

default_variants    +quartz -x11

livecheck.url   http://ftp.gnome.org/pub/gnome/sources/${name}/${branch}
